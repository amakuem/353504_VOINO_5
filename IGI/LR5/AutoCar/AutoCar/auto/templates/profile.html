{% extends 'base.html' %}

{% block content %}
<div class="profile-container">
    <h2>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {{ client }}</h2>
    
    <!-- –õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="section">
        <h3>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</h3>
        <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ client.phone_number }}</p>
        <p><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> {{ client.birth_date|date:"d.m.Y" }}</p>
        <p><strong>Email:</strong> {{ client.user.email }}</p>
    </div>

    <!-- –ü—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ -->
    <div class="section">
        <div class="section-header">
            <h3>–í–∞—à–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏:</h3>
            <a href="{% url 'car_create' %}" class="btn btn-add">
                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å
            </a>
        </div>
        
        {% if client.cars.all %}
            <div class="car-list">
                {% for car in client.cars.all %}
                    <div class="car-item">
                        <div class="car-info">
                            <p>üöó {{ car.model }} ({{ car.license_plate }})</p>
                            {% if car.parking_place %}
                                <p class="parking-info">
                                    –ü–∞—Ä–∫–æ–≤–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ ‚Ññ{{ car.parking_place.number }}
                                </p>
                            {% endif %}
                            <p class="meta-info">
                                –°–æ–∑–¥–∞–Ω–æ: {{ car.created_at|date:"d/m/Y H:i" }}<br>
                                –û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ car.updated_at|date:"d/m/Y H:i" }}
                            </p>
                        </div>
                        <div class="car-actions">
                            <a href="{% url 'car_update' car.pk %}" class="btn btn-edit">
                                <i class="fas fa-edit"></i> –ò–∑–º–µ–Ω–∏—Ç—å
                            </a>
                            <form action="{% url 'car_delete' car.pk %}" method="post" class="delete-form">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-delete">
                                    <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="no-items">–ù–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</p>
        {% endif %}
    </div>

    <!-- –°—á–µ—Ç–∞ -->
    <div class="section">
        <h3>–ò—Å—Ç–æ—Ä–∏—è —Å—á–µ—Ç–æ–≤:</h3>
        {% if invoices %}
            <table class="invoice-table">
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ê–≤—Ç–æ–º–æ–±–∏–ª—å</th>
                        <th>–¢–∏–ø</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody>
                    {% for invoice in invoices %}
                        <tr class="{% if invoice.is_payment %}paid{% else %}pending{% endif %}">
                            <td>{{ invoice.period|date:"m.Y" }}</td>
                            <td>{{ invoice.car.license_plate }}</td>
                            <td>{% if invoice.is_payment %}–û–ø–ª–∞—Ç–∞{% else %}–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ{% endif %}</td>
                            <td>{{ invoice.amount }} —Ä—É–±.</td>
                            <td>
                                {% if invoice.is_payment %}
                                    <span class="status-paid">‚úÖ –û–ø–ª–∞—á–µ–Ω</span>
                                {% else %}
                                    <span class="status-pending">‚è≥ –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã</span>
                                {% endif %}
                            </td>
                            <td>{{ invoice.created_at|date:"d/m/Y H:i" }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="no-items">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—á–µ—Ç–æ–≤</p>
        {% endif %}
    </div>
</div>
{% endblock %}